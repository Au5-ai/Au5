class N{reload(){chrome.runtime.reload()}sendMessage(t,n=()=>{}){chrome.runtime.sendMessage(t,n)}}const k={meetingEndIcon:{selector:".google-symbols",text:"call_end"},captionsIcon:{selector:".google-symbols",text:"closed_caption_off"},transcriptSelectors:{ariaBased:'div[role="region"][tabindex="0"]',fallback:".a4cQT"},transcriptStyles:{opacity:"0.2"},maxTranscriptLength:250,transcriptTrimThreshold:125},s={Service:{webhookUrl:"",token:"",userId:"",fullName:""},Extension:k};var M=(e=>(e.MEETING_STARTED="meetingStarted",e.MEETING_ENDED="meetingEnded",e))(M||{});async function D(e,t){const n=o=>{var i;return((i=o.textContent)==null?void 0:i.trim())===t};for(;;){const i=Array.from(document.querySelectorAll(e)).find(n);if(i instanceof HTMLElement)return i;await new Promise(requestAnimationFrame)}}function I(e,t){const n=document.querySelectorAll(e);if(!t)return Array.from(n);const o=new RegExp(t);return Array.from(n).filter(i=>o.test(i.textContent||""))}class v{static async log(t){try{const n={...t,timestamp:new Date().toISOString(),extensionVersion:"1.0.0",userId:"23f45e89-8b5a-5c55-9df7-240d78a3ce15"};console.log(n)}catch(n){console.warn("[RemoteLogger] Failed to send log",n)}}static info(t,n){this.log({level:"info",message:t,context:n})}static warn(t,n){this.log({level:"warn",message:t,context:n})}static error(t,n){this.log({level:"error",message:t,context:n})}}let A="Mohammad Karimi",B=!1,b=!1;const T=s.Extension.meetingEndIcon,w=s.Extension.captionsIcon;async function L(e){try{await D(T.selector,T.text),e.sendMessage({type:M.MEETING_STARTED}),B=!0}catch(t){console.error("Failed to detect meeting start:",t)}}const R={childList:!0,attributes:!0,subtree:!0,characterData:!0};let l=!0,S=!1,f;L(new N).then(()=>{v.info(U()??"No meeting title found","meetingRoutines");try{const e=I(w.selector,w.text)[0];e==null||e.click();const t=_();if(!t)throw new Error("Transcript container not found in DOM");O(t),F(t),q()}catch(e){console.error("Transcript initialization error:",e),S=!0}}).catch(e=>{console.error("Meeting routine execution failed:",e)});function q(){try{const e=G(s.Extension.meetingEndIcon);if(!e)throw new Error("Meeting end button not found in DOM.");e.addEventListener("click",P)}catch(e){console.error("Error setting up meeting end listener:",e)}}function _(){let e=document.querySelector(s.Extension.transcriptSelectors.ariaBased);return l=!!e,e||(e=document.querySelector(s.Extension.transcriptSelectors.fallback)),e}function O(e){if(l)e.style.opacity=s.Extension.transcriptStyles.opacity;else{const t=e.children[1];t==null||t.setAttribute("style",`opacity: ${s.Extension.transcriptStyles.opacity};`)}}function F(e){f=new MutationObserver($),f.observe(e,R)}function U(){const t=new URL(window.location.href).pathname.split("/").filter(Boolean);return t.length>0?t[t.length-1]:null}let a="",r="",h="";function $(e){var t,n,o,i,y;for(const z of e)try{const c=l?document.querySelector(s.Extension.transcriptSelectors.ariaBased):document.querySelector(s.Extension.transcriptSelectors.fallback),u=l?c==null?void 0:c.children:(n=(t=c==null?void 0:c.childNodes[1])==null?void 0:t.firstChild)==null?void 0:n.childNodes;if(!u)return;if(!(l?u.length>1:u.length>0)){console.log("No active transcript"),a&&r&&m(),a="",r="";continue}const p=l?u[u.length-2]:u[u.length-1],E=p.childNodes[0],x=(o=p.childNodes[1])==null?void 0:o.lastChild,d=((i=E==null?void 0:E.textContent)==null?void 0:i.trim())??"",g=((y=x==null?void 0:x.textContent)==null?void 0:y.trim())??"";if(!d||!g)continue;r===""?(a=d,h=new Date().toISOString(),r=g):a!==d?(m(),a=d,h=new Date().toISOString(),r=g):(l&&g.length-r.length<-ExtensionConfig.maxTranscriptLength&&m(),r=g,!l&&g.length>ExtensionConfig.maxTranscriptLength&&(console.log("Transcript text too long, trimming..."),p.remove())),console.log(r.length>ExtensionConfig.transcriptTrimThreshold?`${r.slice(0,50)} ... ${r.slice(-50)}`:r)}catch(c){console.error(c),!S&&!b&&console.log(ExtensionConfig.reportErrorMessage),S=!0}}let C=[];function m(){if(!r||!h)return;const e=a==="You"?A:a;C.push({personName:e,timestamp:h,text:r})}function G(e){var n,o;const t=I(e.selector,e.text);return((o=(n=t==null?void 0:t[0])==null?void 0:n.parentElement)==null?void 0:o.parentElement)??null}function P(){b=!0,f==null||f.disconnect(),a&&r&&m(),console.log("Meeting ended. Transcript data:",JSON.stringify(C))}
