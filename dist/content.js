class D{reload(){chrome.runtime.reload()}sendMessage(t,n=()=>{}){chrome.runtime.sendMessage(t,n)}}var x=(e=>(e.MEETING_STARTED="meetingStarted",e.MEETING_ENDED="meetingEnded",e))(x||{});async function k(e,t){const n=i=>{var s;return((s=i.textContent)==null?void 0:s.trim())===t};for(;;){const s=Array.from(document.querySelectorAll(e)).find(n);if(s instanceof HTMLElement)return s;await new Promise(requestAnimationFrame)}}function I(e,t){const n=document.querySelectorAll(e);if(!t)return Array.from(n);const i=new RegExp(t);return Array.from(n).filter(s=>i.test(s.textContent||""))}class v{static async log(t){try{const n={...t,timestamp:new Date().toISOString(),extensionVersion:"1.0.0",userId:"23f45e89-8b5a-5c55-9df7-240d78a3ce15"};console.log(n)}catch(n){console.warn("[RemoteLogger] Failed to send log",n)}}static info(t,n){this.log({level:"info",message:t,context:n})}static warn(t,n){this.log({level:"warn",message:t,context:n})}static error(t,n){this.log({level:"error",message:t,context:n})}}const o={userName:"Mohammad Karimi",meetingEndIcon:{selector:".google-symbols",text:"call_end"},captionsIcon:{selector:".google-symbols",text:"closed_caption_off"},transcriptSelectors:{ariaBased:'div[role="region"][tabindex="0"]',fallback:".a4cQT"},transcriptStyles:{opacity:"0.2"},reportErrorMessage:"There is a bug in TranscripTonic. Please report it.",maxTranscriptLength:250,transcriptTrimThreshold:125};let A=o.userName,B=!1,N=!1;const w=o.meetingEndIcon,M=o.captionsIcon;async function C(e){try{await k(w.selector,w.text),e.sendMessage({type:x.MEETING_STARTED}),B=!0}catch(t){console.error("Failed to detect meeting start:",t)}}const L={childList:!0,attributes:!0,subtree:!0,characterData:!0};let a=!0,S=!1,g;C(new D).then(()=>{v.info(F()??"No meeting title found","meetingRoutines");try{const e=I(M.selector,M.text)[0];e==null||e.click();const t=q();if(!t)throw new Error("Transcript container not found in DOM");O(t),_(t),R()}catch(e){console.error("Transcript initialization error:",e),S=!0}}).catch(e=>{console.error("Meeting routine execution failed:",e)});function R(){try{const e=P(o.meetingEndIcon);if(!e)throw new Error("Meeting end button not found in DOM.");e.addEventListener("click",U)}catch(e){console.error("Error setting up meeting end listener:",e)}}function q(){let e=document.querySelector(o.transcriptSelectors.ariaBased);return a=!!e,e||(e=document.querySelector(o.transcriptSelectors.fallback)),e}function O(e){if(a)e.style.opacity=o.transcriptStyles.opacity;else{const t=e.children[1];t==null||t.setAttribute("style",`opacity: ${o.transcriptStyles.opacity};`)}}function _(e){g=new MutationObserver(G),g.observe(e,L)}function F(){const t=new URL(window.location.href).pathname.split("/").filter(Boolean);return t.length>0?t[t.length-1]:null}let l="",r="",p="";function G(e){var t,n,i,s,E;for(const $ of e)try{const c=a?document.querySelector(o.transcriptSelectors.ariaBased):document.querySelector(o.transcriptSelectors.fallback),u=a?c==null?void 0:c.children:(n=(t=c==null?void 0:c.childNodes[1])==null?void 0:t.firstChild)==null?void 0:n.childNodes;if(!u)return;if(!(a?u.length>1:u.length>0)){console.log("No active transcript"),l&&r&&f(),l="",r="";continue}const h=a?u[u.length-2]:u[u.length-1],T=h.childNodes[0],y=(i=h.childNodes[1])==null?void 0:i.lastChild,m=((s=T==null?void 0:T.textContent)==null?void 0:s.trim())??"",d=((E=y==null?void 0:y.textContent)==null?void 0:E.trim())??"";if(!m||!d)continue;r===""?(l=m,p=new Date().toISOString(),r=d):l!==m?(f(),l=m,p=new Date().toISOString(),r=d):(a&&d.length-r.length<-o.maxTranscriptLength&&f(),r=d,!a&&d.length>o.maxTranscriptLength&&(console.log("Transcript text too long, trimming..."),h.remove())),console.log(r.length>o.transcriptTrimThreshold?`${r.slice(0,50)} ... ${r.slice(-50)}`:r)}catch(c){console.error(c),!S&&!N&&console.log(o.reportErrorMessage),S=!0}}let b=[];function f(){if(!r||!p)return;const e=l==="You"?A:l;b.push({personName:e,timestamp:p,text:r})}function P(e){var n,i;const t=I(e.selector,e.text);return((i=(n=t==null?void 0:t[0])==null?void 0:n.parentElement)==null?void 0:i.parentElement)??null}function U(){N=!0,g==null||g.disconnect(),l&&r&&f(),console.log("Meeting ended. Transcript data:",JSON.stringify(b))}
